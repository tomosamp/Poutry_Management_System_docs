# 生産者一覧 機能仕様

## 1. 概要
- **目的**: 生産者（工場）マスタを横断検索し、現在の提出状況やステータスを一覧で把握できるようにする。
- **対象画面**: `03_生産者一覧`。
- **前提**: 認証済みユーザーのみアクセス可能。Laravel + Bladeでレンダリング。

## 2. 主なユースケース
1. 工場名や鳥種、地域ブロックで検索し該当生産者を素早く探す。
2. 最終提出日や提出ステータスを一覧で確認し、未提出・警告ありの工場を抽出する。
3. 対象工場の詳細編集やデータ提出（CSV/手入力）に遷移する。

## 3. 入出力
| 区分 | 項目 | 内容 |
| --- | --- | --- |
| 入力（検索条件） | 工場名キーワード | 部分一致／大文字小文字無視。工場名カナも対象。 |
| 入力（検索条件） | 鳥種 | 全て／ブロイラー／成鶏／地鶏。 |
| 入力（検索条件） | 地域ブロック | 全て／A〜F。 |
| 入力（検索条件） | 提出ステータス | 全て／提出済／未提出／警告あり（将来追加可能）。 |
| 出力 | 一覧データ | 工場ID、工場名、鳥種、地域ブロック、最終提出日、提出ステータス、特記事項有無。 |
| 出力 | ページ情報 | 件数、ページ番号、総ページ数。 |

## 4. ロジック
- **検索処理**: `producers` テーブル（想定）をベースに、工場名/カナ・鳥種・地域ブロックでフィルタ。検索はEloquentクエリビルダで実装。
- **提出ステータス計算**: 最新月の提出履歴から状態を判定。  
  - 提出済: 当該月の提出履歴が存在。  
  - 未提出: 提出履歴なし。  
  - 警告あり: 最新履歴に未解決警告フラグが立っている。
- **最終提出日**: 提出履歴テーブルの最新登録日時を参照。
- **特記事項有無**: メモが存在する場合にアイコン表示（真偽値）。
- **並び替え**: デフォルトは工場名昇順。ユーザーが工場名／最終提出日で切り替え可能。
- **ページング**: 20件／ページ。Laravelのページネータを使用。
- **ショートカット遷移**: 行アクションから各画面へ `producer_id` をクエリパラメータで付与。

## 5. バリデーション
- 工場名検索は最大100文字まで。
- 鳥種・地域ブロックは定義済みマスタ値と一致するもののみ許可。
- ページ番号は正の整数。範囲外指定は最終ページを返却。

## 6. 例外・エラー処理
- データ取得失敗時は「生産者情報の取得に失敗しました。再度お試しください。」を表示し、`storage/logs/laravel.log` にスタックトレースを出力。
- 提出履歴参照で異常があった場合はステータス列に「取得エラー」と表示し、詳細操作時に再取得を試みる。

## 7. 今後の拡張
- ステータスフィルタに「廃業」「合併中」などを追加。

# 生産者新規登録 機能仕様

## 1. 概要
- **目的**: 新規生産者（施設）の基本情報・所在地・申請者情報を登録し、システム内で管理できるようにする。
- **対象画面**: `05_生産者新規登録`。
- **前提**: Laravel + Bladeによるフォーム入力。登録後は生産者詳細画面へ遷移。

## 2. 主なユースケース
1. 新たに加盟した生産者の登録を行う。
2. 地域ブロックを選択し設定する。
3. 申請者を最低1名登録し、データ提出時の窓口を管理する。

## 3. 入出力
| 区分 | 項目 | 内容 |
| --- | --- | --- |
| 入力 | 生産者名・生産者名カナ | それぞれ100文字以内／任意カナ。重複チェックあり。 |
| 入力 | 鳥種 | ブロイラー／成鶏／地鶏から選択。 |
| 入力 | 事業者種別 | 企業／家族経営。 |
| 入力 | 地域ブロック | 手動選択。 |
| 入力 | 代表者情報 | 氏名・役職・電話（任意）。 |
| 入力 | 申請者情報 | 氏名（必須）、部署、電話（必須）、メール（必須）。複数登録可。 |
| 入力 | 確認チェック | 「データ内容を確認しました」。 |
| 出力 | 登録結果 | 成功メッセージ／エラーメッセージ。 |

## 4. ロジック
- **重複チェック**: 生産者名・鳥種の組み合わせで重複していないか事前に確認する。既存レコードがある場合は詳細画面へのリンクを提示する。
- **地域ブロック判定**: 登録者が設定可能。
- **申請者登録**: 最低1件必須。フォームで複数行追加し、保存時に `producers`（`role_type=applicant`）へまとめてInsertする。
- **登録処理**:
  1. `facilities` に生産者（施設）基本情報（名称/カナ/鳥種/地域ブロック/所在地/事業者種別）を登録する。
  2. 代表者情報は `producers`（`role_type=representative`）として登録する（任意）。
  3. 申請者情報を `producers`（`role_type=applicant`）として登録する（最低1件必須）。
- **遷移**: 登録成功後に詳細画面へリダイレクトし、トーストで成功表示。

## 5. バリデーション
- 生産者名: 必須／最大100文字。トリム後にチェック。
- 鳥種・事業者種別: 定義済みコードのみ。
- 申請者メール: RFC準拠簡易チェック。既存申請者との重複許可（同名でもメールが異なる場合OK）。
- 申請者電話: 数字＋ハイフン15文字以内。
- 確認チェック: ONでない場合は登録不可。

## 6. 例外・エラー処理
- 登録時エラー（DB例外等）はフォーム上部にエラーを表示し、入力値を保持する。詳細は `storage/logs/laravel.log` に出力。
- 重複検知時はエラーとし、既存生産者詳細画面へのリンクを提示。

## 7. 今後の拡張
- CSVインポートによる初期データ投入用スクリプトとの整合。
- 代表者情報の履歴管理。
- 入力途中の一時保存（ドラフト）機能。

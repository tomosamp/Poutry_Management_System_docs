# ALIC_BR_EXCEL 提出フォーマット仕様

## 1. 対象
- 提出先: エーリック（農畜産業振興機構）
- 鳥種: ブロイラー
- 集計: 全国
- 形式: Excel

## 2. テンプレ配置
- 配置先: `app/src/storage/app/export_templates/ALIC_BR_EXCEL.xlsx`
- テンプレコードとファイル名は `export_templates.code` で紐付ける。

## 3. 出力ファイル名
- 形式: `ブロイラー（ALIC宛）｜R{令和年}.{提出月}生産・処理動向調査報告.xlsx`
- 例: `ブロイラー（ALIC宛）｜R7.9生産・処理動向調査報告.xlsx`
  - `R7.9` は提出月が2025年9月の場合の表記。
  - 令和年: `西暦 - 2018` とする。
- 次年度ファイルが必要な場合は末尾に `（次年度）` を付与する。

## 3.1 シート名
- 形式: `R{令和年}全国`
- 令和年は「出力対象年（ファイル内の年度）」から算出する（`西暦 - 2018`）。
- 年度跨ぎで2ファイル出力される場合は、各ファイルの出力対象年に合わせて設定する。
  - 例: 提出月が2025年12月の場合は `R7全国` と `R8全国` の2ファイルが出力される。

## 4. セルマッピング
### 4.0 タイトルセル
- `A1`: `ブロイラー生産・処理動向調査報告令和{R}年（令和{R}年{提出月}月集計）`
  - `{R}` は提出月の西暦から令和換算（西暦-2018）。
  - `{提出月}` は提出月（締切月）の月。

### 4.1 年号セル（赤字）
- 昨昨年: `B15`, `B27`, `B39`
- 昨年: `B16`, `B28`, `B40`
- 表記は `R{令和年}年全国` の形式とする。

### 4.1.1 外部協会値（年号行の月次値）
- `B15/B27/B39` 行には「対象年度-2年」の外部協会値を `C〜N` に入力する。
- `B16/B28/B40` 行には「対象年度-1年」の外部協会値を `C〜N` に入力する。
- 参照元は `monthly_aggregate_values`（`data_source=external` / 全国のみ）。

### 4.2 値の入力セル
- ひな入雛羽数: `C12〜N12`（1月〜12月）, `O12`（合計）
- ひな入雛羽数（前年度集計）: `C13〜N13`（1月〜12月）, `O13`（合計）
- 生体処理羽数: `C24〜N24`（1月〜12月）, `O24`（合計）
- 生体処理羽数（前年度集計）: `C25〜N25`（1月〜12月）, `O25`（合計）
- 生体処理重量: `C36〜N36`（1月〜12月）, `O36`（合計）
- 生体処理重量（前年度集計）: `C37〜N37`（1月〜12月）, `O37`（合計）
- ひな入雛羽数/生体処理羽数は千羽単位で出力（`値/1000` を四捨五入）
- 生体処理重量はトン単位で出力（`kg/1000` を四捨五入）
- 前年度集計の欠損月は0で出力する。

### 4.3 背景色（提出月に紐づく強調）
- 11〜19行目、23〜31行目、35〜43行目の対象月列を黄色で強調する。
- 対象列は「実績（提出月-1）」と「予定（提出月〜提出月+2）」の計4ヶ月分。
- 年度境界を跨ぐ場合は、当年度ファイルと次年度ファイルでそれぞれ該当列を強調する。
- `monthly_aggregate_values.aggregate_version_no > 1` の項目は変更差分色（例：薄青 `#B7DEE8`）で強調し、提出月由来のハイライトより優先する（外部協会値も同様）。

## 5. 出力処理（概要）
- 全体の処理フローは `docs/03_基本設計/機能設計/30_集計・出力/00_月次年次レポート.md` に従う。

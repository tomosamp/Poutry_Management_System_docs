# CSVアップロード画面

## 1. 画面概要
- 目的: 工場単位または複数工場分の月次データをCSVから取り込み、形式・項目・数値の妥当性検証を実施した上で登録に進む。
- 主利用者: 食鳥協会職員。
- 画面カテゴリ: データ提出。

## 2. 主なフロー
1. 画面上部の「一括アップロード」ボタンからモーダルを開く（ヘッダー常設）。
2. 対象月を選択（初期値は当月）。
3. ドラッグ&ドロップ領域にCSVファイルを投入（複数ファイル可、同月分は上書き選択）。
4. アップロード直後に自動検証を実行し、工場ごとのステータス結果をテーブル表示。
5. 入力確認画面に引き渡し、警告・エラー行は項目下部に表示や個社対応（生産者詳細画面）で処理。

## 3. 画面要素
| ID | 項目 | 種別 | 必須 | 検証・挙動 |
| --- | --- | --- | --- | --- |
| BTN-UP-HEAD-01 | 一括アップロード | ボタン | - | 画面ヘッダーに固定表示。押下でモーダルを開き、対象月/ファイルの設定を誘導。 |
| SEL-UP-02 | 提出月 | 月選択 | 必須 | YYYY-MM形式。未来3ヶ月先まで選択可能。 |
| DROP-UP-01 | CSVドラッグ&ドロップエリア | ドロップゾーン | 必須 | 複数ファイル対応。同一月が重複した場合は最新ファイルで上書き確認。 |
| FLD-UP-01 | CSVファイル | ファイル選択 | 任意 | ドロップが難しい場合のフォールバック。 |
| BTN-UP-01 | アップロード開始 | ボタン | - | ファイル投入後に活性化、即時検証を実行。 |
| TABLE-UP-01 | 検証結果一覧 | テーブル | - | 行単位で工場名/項目/ステータス（OK/警告/エラー）を表示。 |
| BTN-UP-02 | 確認へ進む | ボタン | - | エラーが0件の行のみ対象に入力確認画面へ進む。 |
| BTN-UP-03 | エラー行ダウンロード | ボタン | 任意 | エラー行のみCSV出力し再修正を容易にする。 |
| BTN-UP-04 | キャンセル | ボタン | - | 生産者一覧またはデータ提出メニューへ戻る。 |

## 4. 検証ルール
- ファイル形式: ヘッダー一致、列数チェック。鳥種別の必須列セットを別定義し、ヘッダー照合時に切替。
- 項目検証: ブロイラー/地鶏/成鶏で入力項目が異なるため、CSV内の鳥種列に応じて検証テンプレートを選択。
- 数値範囲: 負値禁止、桁数チェック。Null（空欄）は許容し、意図的な未入力をエラー判定しない。
- 比較検証: 導入羽数 < 処理羽数の場合は警告、前年度同月比±30%を超える際に警告。
- 工場識別子（IDまたは工場コード）の存在を必須とし、未登録工場行はエラーとする。新規工場の行は生産者詳細画面で個別登録後に再取込を促す。

## 5. メッセージ仕様
- エラー: 「工場ID: XXX の翌月予定が未入力です」など具体的項目名と対象行を表示。
- 警告: 黄色アイコン表示、続行可能。
- 成功: 「検証が完了しました。確認画面へ進んでください。」

## 6. 遷移
- 確認へ進む → 入力確認画面（正常行のみを保持して遷移）。
- エラー行ダウンロード → エラー内容付きCSVをダウンロード。
- キャンセル → 生産者一覧（選択状態は破棄）。

## 7. 備考
- Googleフォーム経由で取得したCSVを想定し、標準フォーマット（1工場複数行含む）を前提とする。
- 個別アップロードは生産者詳細・編集画面のアクションとして提供し、本画面では月次一括アップロードに特化する。
- アップロードにより生成されたレコードは生産者に紐付いて履歴登録され、既存データとの差分は保持する。差分統合ロジックは次フェーズで詳細設計。
- CSV項目ごとの補足メモ（備考列）を保持し、手入力画面と共通のメモAPIで参照可能にする。
- エラーが残る行は入力確認画面に渡し確認、必要があればその場での修正。

# テーブル一覧
フェーズ: 1 / 状態: 現行 / 最終更新: 2025-12-11 / 最新版リンク: 相対パス

## ドキュメント目的
- 本プロジェクトで確定したテーブル仕様を一覧し、詳細設計・レビューを迅速化する。
- 各テーブルの詳細は必要に応じて個別ドキュメントへ展開する。

## 記載ルール
| 項目 | ルール | 備考 |
|---|---|---|
| テーブル名 | スネークケース小文字。 | 例: `admins` |
| 主キー | 複合の場合は列順を明示。 | 例: `facility_id + bird_species_id + target_month + version_no` |
| 主要カラム | 業務的に重要なものを3〜6項目。 | 値カラムはまとめて表記可 |
| インデックス | ユニーク/通常、複合を明示。 | 例: `email (UNIQUE)` |
| リレーション | `テーブル.col ⇔ テーブル.col` 形式。 | FK無しは `-` |
| 詳細設計 | 未整備は `-`。 | 相対パスで記載 |

## テーブル一覧

### 認証・共通
| No | テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|---|
| 01 | admins | 職長協会向け管理アカウント | id | email, password, last_name, first_name, deleted_at | email (UNIQUE) | - | - | emailでログイン。passwordはハッシュ保持 |

### マスタ
| No | テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|---|
| 02 | bird_species | 鳥種マスタ（地鶏/成鶏/ブロイラー固定） | id | code, name | code (UNIQUE) | - | - | 初期データ固定投入 |
| 03 | region_blocks | 地区ブロック A〜F | id | code, name | code (UNIQUE) | region_blocks.id ⇔ prefectures.region_block_id / facilities.region_block_id | - | 成鶏は地区なしでNULL可 |
| 04 | prefectures | 都道府県 | id | code, name, region_block_id | code (UNIQUE), region_block_id | prefectures.id ⇔ facilities.prefecture_id | - | 地区は地鶏/ブロイラーで必須 |
| 05 | export_templates | 提出先フォーマットマスタ | code | name, output_format(excel/pdf), bird_species_code, layout_definition_json, is_active | code (PRIMARY) | export_templates.code ⇔ agency_exports.template_code | - | 初期コード: ALIC*, SHOKUCHO*, CHIKUSAN*, MEMBER* |

### 生産者管理
| No | テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|---|
| 06 | facilities | 施設基本情報（鳥種単位） | id | bird_species_id, region_block_id(NULL可:成鶏), prefecture_id, name, name_kana, postal_code, city, address_line, business_type, closed_at, merge_or_close_memo, sort_order, merged_into_facility_id, merged_at, deleted_at | region_block_id + sort_order（任意Idx）, bird_species_id + sort_order（任意Idx）, prefecture_id | bird_species.id ⇔ facilities.bird_species_id / region_blocks.id ⇔ facilities.region_block_id / prefectures.id ⇔ facilities.prefecture_id / facilities.id ⇔ facilities.merged_into_facility_id | - | 並び順は画面側で判定（DBは非ユニーク） |
| 07 | producers | 生産者アカウント（代表/申請者兼用） | id | facility_id, name系(氏/名/カナ), department, email, phone_number, role_type | facility_id, role_type | facilities.id ⇔ producers.facility_id | - | role_type=representative/applicant |
| 08 | producer_notes | 施設への特記事項メモ | id | facility_id, author_type(producer/admin), author_id, note_text | facility_id | facilities.id ⇔ producer_notes.facility_id | - | 記載者は生産者または管理者 |
| 09 | facility_merge_histories | 施設（生産者）合併履歴 | id | source_facility_id, target_facility_id, merged_at, merged_by_admin_id, reason | source_facility_id, target_facility_id | facilities.id ⇔ facility_merge_histories.{source_facility_id,target_facility_id} | - | 合併後はsourceに merged_into_facility_id / deleted_at を設定 |

### 月次データ（入力・履歴）
| No | テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|---|
| 10 | monthly_records | 施設×月×鳥種の元データ（ワイド） | id (推奨: facility_id + bird_species_id + target_month + version_no) | target_month, version_no, data_kind(actual/plan), input_method, input_timestamp, source_email_raw, registered_by_admin_id, note_text, 値カラム(ひな入雛/処理羽数/処理重量kg/禁止/全部廃棄/一部廃棄/コメント) | facility_id + bird_species_id + target_month, data_kind | facilities.id ⇔ monthly_records.facility_id / bird_species.id ⇔ monthly_records.bird_species_id | - | 重量はkg（整数）で保持。CSVタイムスタンプはTIMESTAMPで保持。version自動採番 |
| 11 | monthly_record_change_logs | 月次データの差分履歴 | id | record_id, field_name, before_value, after_value, change_memo, changed_by_type, changed_by_id, changed_at | record_id, changed_at | monthly_records.id ⇔ monthly_record_change_logs.record_id | - | CSVも自動差分記録。手入力のみchange_memo記入可 |

### 関係機関提出・エクスポート
| No | テーブル名 | 概要 | 主キー | 主要カラム | インデックス | リレーション | 詳細設計 | 備考 |
|---|---|---|---|---|---|---|---|---|
| 12 | agency_exports | 提出スナップショット（版管理） | id (推奨: facility_id + bird_species_id + period_type + target_month + template_code + export_version_no) | period_type, target_month, template_code, export_version_no, source_record_id(NULL可), source_record_version_no(NULL可), payload_json, exported_at, exported_by_admin_id | facility_id + period_type + target_month + template_code | facilities.id ⇔ agency_exports.facility_id / bird_species.id ⇔ agency_exports.bird_species_id / export_templates.code ⇔ agency_exports.template_code | - | 年次は period_type=year + target_month=年度開始月(YYYY-04-01) + payloadに12ヶ月分。差分セルは黄色ハイライト |
| 13 | agency_export_values | 提出スナップショットの正規化 | id | agency_export_id, metric_key, value_decimal, value_text | agency_export_id | agency_exports.id ⇔ agency_export_values.agency_export_id | - | 必要に応じて使用 |

## 改定履歴
| 改定日 | 版数 | 変更概要 | 担当 |
|---|---|---|---|
| 2025-12-11 | v1.0 | ミニマム構成をテンプレ形式に再整理（番号付与、合併/地区ルール反映） | Codex |

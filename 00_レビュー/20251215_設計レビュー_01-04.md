# 設計レビュー（docs/01〜04）

対象: 2025-12-15 時点の `docs/01_プロジェクト`〜`docs/04_詳細設計`

## 1. 結論（サマリ）
- **ナビゲーション**: ヘッダー前提の記述をサイドバー前提に統一し、メニュー構造を最新UIに寄せました。
- **画面/機能の整理**: 「月次提出状況」画面を削除し、**提出履歴一覧の未提出フィルタ**で代替する方針に統一しました。
- **集計・出力**: 「月次/年次レポート」と「関係機関連携エクスポート」を**1画面（11）に統合**する方針に統一しました。
- **CSV仕様**: ブロイラー/地鶏/成鶏のヘッダー定義（列位置固定）と、CSV取り込みフロー（鳥種別×提出月別の一括専用）を確定反映しました。

## 実装可否（結論）
- **実装は着手可能**（画面・DB・主要フローは概ね整合）。
- **残ブロッカーなし**（CSVの生産者割り出しロジックも確定済）。

## 2. DB設計↔画面/機能の整合（修正・反映済）
- **生産者の実体**: 画面/機能側の「生産者（工場）」を、DBの `facilities`（施設）として扱う前提に整理。
  - 参照: `docs/04_詳細設計/DB設計/06_facilities.md`
- **申請者/代表者**: 申請者の履歴管理を、DBの `producers`（`role_type=representative/applicant` + `deleted_at`）で扱う前提に整理。
  - 参照: `docs/04_詳細設計/DB設計/07_producers.md`
- **所在地/事業者種別**: 画面設計の入力項目とDBの保持項目を合わせるため、`facilities` に `prefecture_id` / `postal_code` / `business_type` を追加して整合を取りました。
  - 参照: `docs/04_詳細設計/DB設計/06_facilities.md`
  - 参照: `docs/04_詳細設計/DB設計/テーブル一覧.md`
- **提出状況（未提出抽出）**: 「月次提出状況」専用画面を廃止し、`monthly_records` の有無で提出済/未提出を判定する設計に統一。
  - 参照: `docs/03_基本設計/画面設計/管理者/09_提出履歴一覧.md`
- **年次出力の保存**: 年次出力も「出力スナップショット」として `agency_exports` に保存し、月次との差分は期間区分（`period_type`）で表現する方針に統一。
  - 参照: `docs/04_詳細設計/DB設計/12_agency_exports.md`
  - 参照: `docs/03_基本設計/画面設計/管理者/11_月次年次レポート.md`
- **施設編集履歴（監査ログ）**: 施設情報の編集履歴は保持しない（`updated_at` 更新のみ）方針に統一。
  - 参照: `docs/02_要件定義/業務要件定義書.md`
  - 参照: `docs/03_基本設計/画面設計/管理者/04_生産者詳細・編集.md`
- **重量の保持単位**: DBは重量をkg（整数）で保持し、トン保持による丸めブレを避ける方針に統一。
  - 参照: `docs/04_詳細設計/DB設計/10_monthly_records.md`
- 参照: `docs/03_基本設計/機能設計/30_集計・出力/00_月次年次レポート.md`
- **住所の分割保持**: 画面入力（市区町村/番地）に合わせ、DBも `facilities.city` / `facilities.address_line` で分離保持する方針に統一。
  - 参照: `docs/04_詳細設計/DB設計/06_facilities.md`

## 3. 要確認（残タスク）
- （なし）

## 4. 変更点（ドキュメント/画面整理）
- **サイドバー化**: `docs/03_基本設計/機能設計/02_共通UI/01_グローバルサイドバー.md`
- **提出履歴の分離**: 一覧（09）追加、詳細は（10）へ整理
  - `docs/03_基本設計/画面設計/管理者/09_提出履歴一覧.md`
  - `docs/03_基本設計/画面設計/管理者/10_提出履歴詳細.md`
- **削除/統合**:
  - 「月次提出状況」画面を廃止（提出履歴一覧の未提出フィルタで代替）。
  - 「関係機関連携エクスポート」を「月次/年次レポート」へ統合（提出先選択→整形→Excel/PDF出力）。
